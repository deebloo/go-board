# go-board

Go Board WebComponent. Stones indicate the order of moved played. The board component will make sure the correct game state is reflected on the board itself. The entire library weights less than 5kb gzip and less than 4k brotli which makes it performant to embed into existing web pages. If you want to see exactly what the board is calculating you can enable debugging by adding the "debug" attribute to go-board. (`<go-board debug></go-board>`)

[Demo](https://go-viewer.web.app/)

[StackBlitz](https://stackblitz.com/edit/go-board-demo?file=index.html)

## All you need to get started is some markup and a script tag

```HTML
<script src="https://cdn.jsdelivr.net/npm/go-board@2.1.1/target/bundle/go-board.min.js"></script>

<go-board>
  <go-stone color="black" space="R17"></go-stone>
  <go-stone color="white" space="R18"></go-stone>
  <go-stone color="black" space="Q18"></go-stone>
  <go-stone color="white" space="S18"></go-stone>
  <go-stone color="black" space="S17"></go-stone>
  <go-stone color="white" space="R19"></go-stone>
  <go-stone color="black" space="Q19"></go-stone>
  <go-stone color="white" space="T18"></go-stone>
  <go-stone color="black" space="T17"></go-stone>
  <go-stone color="white" space="Q16"></go-stone>
  <go-stone color="black" space="S19"></go-stone>
  <go-stone color="white" space="T19"></go-stone>
  <go-stone color="black" space="S19"></go-stone>
</go-board>
```

## Display a game from [OGS](https://online-go.com).

This library ships with an SGF viewer. If you pass in a game id from OGS it will play out automatically. There is also an imperative API if you want to pause and resume play/

```html
<sgf-viewer ogs-id="50728274">
  <go-board></go-board>
</sgf-viewer>
```

## Small

The entire go-board code is small enough that is can be inlined directly into your HTML page.

```js
!function(){"use strict";class t{#t;#e=null;#o=null;constructor(t){this.#t=t}toString(){return this.#e||(this.#e=this.#t.toString()),this.#e}toValue(){return this.#o||(this.#o=this.createValue(this.toString())),this.#o}}class e extends t{createValue(t){const e=document.createElement("template");return e.innerHTML=t,e}}class o extends t{createValue(t){if(document.adoptedStyleSheets){const e=new CSSStyleSheet;return e.replaceSync(t),e}const e=document.createElement("style");return e.innerHTML=t,e}}function s(t){return new e(t)}function r(t){return new o(t)}function n(t,e){if(t.shadowRoot)return t.shadowRoot;const o=t.attachShadow({mode:"open"});return e?.css&&(Array.isArray(e.css)?e.css.forEach((t=>{a(o,t)})):a(o,e.css)),e?.html&&o.append(e.html.toValue().content.cloneNode(!0)),o}function a(t,e){const o=e.toValue();o instanceof CSSStyleSheet?t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]:o instanceof HTMLStyleElement&&t.append(o)}const i=new class{#s=!1;group(...t){this.#s&&console.group(...t)}groupEnd(){this.#s&&console.groupEnd()}log(...t){this.eval((()=>{console.log("DEBUG:",...t)}))}eval(t){this.#s&&t()}enable(){this.#s=!0}disable(){this.#s=!1}},l={css:r`:host{box-shadow:0 1px 4px rgba(0,0,0,.5);display:inline-flex;border-radius:50%;height:50px;width:50px}:host([color=black]){background:#000;background-image:radial-gradient(circle at center,rgba(255,255,255,.2),rgba(0,0,0,0) 45%)}:host([color=white]){background:#fff;background-image:radial-gradient(circle at center,rgba(0,0,0,0),rgba(0,0,0,.15))}`};class c extends HTMLElement{static create(t,e=""){const o=new c;return o.color=t,o.space=e,o}get color(){return this.getAttribute("color")||"black"}set color(t){this.setAttribute("color",t)}get space(){return this.getAttribute("space")||""}set space(t){this.setAttribute("space",t)}#r=null;constructor(){super(),n(this,l)}connectedCallback(){this.parentElement instanceof b&&(this.#r=this.parentElement,this.#r.onStoneAdded(this))}}class d{stones=new Set;liberties=new Set}function h(t,e,o=new d){o.stones.add(e);const s=u(t,e);for(let r=0;r<s.length;r++){const n=s[r],a=t.querySelector(`[slot="${s[r]}"]`);a?a.color!==e.color||o.stones.has(a)||(o.stones.add(a),h(t,a,o)):o.liberties.add(n)}return o}function u(t,e){const{columnLabels:o}=t,s=function(t){const e=t.space.split("");return{col:e.shift(),row:e.join("")}}(e),r=Number(s.row),n=o.indexOf(s.col);return[{row:r+1,col:n},{row:r-1,col:n},{row:r,col:n-1},{row:r,col:n+1}].filter((({row:e,col:o})=>{const s=e<=t.rows&&e>0,r=o>-1&&o<t.cols;return s&&r})).map((({row:t,col:e})=>`${o[e]}${t}`))}const p={css:r`:host{box-sizing:border-box;background:#caa472;display:block;padding:1rem;position:relative;box-shadow:0 0 8px rgba(0,0,0,.3);aspect-ratio:1/1;font-size:clamp(2.5vh,2.5vw)}:host([show-coords=false]) #header>*{visibility:hidden}:host([show-coords=false]) .row>:first-child{visibility:hidden}*{box-sizing:border-box;font-family:inherit}.row{display:flex;width:100%}.row>*{align-items:center;justify-content:center;border-top:solid 1px #000;border-left:solid 1px #000;display:flex;flex-grow:1;aspect-ratio:1/1;position:relative}.row>*>*{position:absolute}#header>*{border-color:transparent;transform:translate(-50%,-20%)}.row board-spacer{border-color:transparent;transform:translate(-20%,-50%)}.row:last-child slot{border-color:transparent;border-top:solid 1px #000}.row slot:last-child{border-color:transparent;border-left:solid 1px #000}.row:last-child slot:last-child{border-color:transparent}.row slot button,.row slot::slotted(go-stone){position:absolute;transform:translate(-50%,-50%);padding:0;height:98%;width:98%;display:flex;align-items:center;justify-content:center}.row slot::slotted(go-stone){z-index:1000}.row slot.starpoint:after{content:"";display:block;height:25%;width:25%;background:#000;border-radius:50%;position:absolute;transform:translate(-50%,-50%);top:0;left:0}.row slot::slotted(go-stone:last-child)::after{content:"";height:50%;width:50%;border-radius:50%;border:solid 2px}.row slot::slotted(go-stone[color=white]:last-child)::after{border-color:#000}.row slot::slotted(go-stone[color=black]:last-child)::after{border-color:#fff}.row slot::slotted(go-stone[draggable=true]){cursor:grab}.row slot::slotted(go-stone[draggable=true]:active){cursor:grabbing}.row slot button{border:none;opacity:0;cursor:pointer;z-index:1}:host .row slot button:hover{background:0 0;opacity:.85!important}:host .row slot button:after{content:"";display:block;border-radius:50%;height:100%;width:100%}:host([turn=black]) .row slot button:hover:after{background:#000}:host([turn=white]) .row slot button:hover:after{background:#fff}`,html:s`<div id="header" class="row"><board-spacer></board-spacer></div>`};class b extends HTMLElement{get turn(){return this.getAttribute("turn")||"black"}set turn(t){this.setAttribute("turn",t)}get mode(){return this.getAttribute("mode")||"game"}set mode(t){this.setAttribute("mode",t)}rows=19;cols=19;columnLabels=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];#n=n(this,p);#a=this.#n.getElementById("header");#i=new Set;constructor(){super(),this.#n.addEventListener("click",this.#l.bind(this)),this.#c(),this.#d()}connectedCallback(){this.hasAttribute("turn")||(this.turn="black")}onStoneAdded(t){this.turn=t.color,t.slot=t.space,"game"===this.mode&&this.#h(t)}key(){const t=[];for(let e of this.children)e instanceof c&&e.slot&&t.push(e);t.sort(g);let e="";for(let o of t)e+=o.slot+o.color;return e}reset(){this.innerHTML="",this.#i.clear(),this.turn="black"}copyToClipboard(){return navigator.clipboard.writeText(this.outerHTML)}#h(t){i.group("Checking stone:",t);const e=function(t,e){const o=u(t,e),s=[];for(let r=0;r<o.length;r++){const n=t.querySelector(`[slot="${o[r]}"]`);n&&n.color!==e.color&&s.push(n)}return s}(this,t);i.log("Finding enemy stones:",e);const o=[];for(let t of e){const e=h(this,t);if(!e.liberties.size){i.log("Removing Stones:\n",...e.stones);for(let t of e.stones)t.removeAttribute("slot"),o.push(t)}}const s=this.key();if(this.#i.has(s)){for(let t of o)t.slot=t.space;alert("Move is not allowed"),t.remove()}else{this.#i.add(s);const e=h(this,t);i.log("Stone part of following group:",e),e.liberties.size?this.turn="black"===t.color?"white":"black":(t.remove(),alert("Move is suicidal!"))}i.groupEnd()}#l(t){if(t.target instanceof HTMLButtonElement){const e=c.create(this.turn,t.target.id);this.append(e)}}#c(){for(let t=0;t<this.rows;t++){const e=document.createElement("div");e.className="row";const o=document.createElement("board-spacer");e.append(o);const s=document.createElement("span");s.innerHTML=(this.rows-t).toString(),o.append(s);for(let o=0;o<this.cols;o++)e.append(this.#u(t,o));this.#n.append(e)}}#d(){for(let t=0;t<this.rows;t++){const e=document.createElement("div"),o=document.createElement("span");o.innerHTML=this.columnLabels[t],e.append(o),this.#a.append(e)}}#u(t,e){const o=document.createElement("slot");o.name=`${this.columnLabels[e]}${this.rows-t}`;const s=Math.floor(this.rows/3),r=Math.floor(this.rows/4)-1,n=[r,r+s,r+2*s];n.includes(t)&&n.includes(e)&&o.classList.add("starpoint");const a=document.createElement("button");return a.title=o.name,a.id=o.name,i.eval((()=>{a.style.opacity=".2"})),o.append(a),o}}function g(t,e){const o=f(t.slot),s=f(e.slot),r=o.col.localeCompare(s.col);return 0!==r?r:Number(o.row)-Number(s.row)}function f(t){const e=t.split("");return{col:e.shift(),row:e.join("")}}const m=Array.from(Array(26)).map(((t,e)=>e+65)).map((t=>String.fromCharCode(t))),w=/([A-Z])\[([a-z]{2})\]/,y={css:r`:host{display:contents}`,html:s`<slot></slot>`};class S extends HTMLElement{path;ogsId;isRunning=!1;delay=5;#p=this.querySelector("go-board");#b=[];#g=0;constructor(){super(),n(this,y)}async go(t){if(this.isRunning=!0,this.#b.length||(i.log("clearning board"),this.#p.reset()),this.#b.length)return this.play(t);const e=this.ogsId?`https://online-go.com/api/v1/games/${this.ogsId}/sgf`:this.path;if(e){const o=await fetch(e).then((t=>t.text()));this.#b=this.parseSGF(o),this.play(t)}}async play(t){if(this.isRunning){this.#g>=this.#b.length&&this.#p.reset();const e=this.#b[this.#g];this.#g+=1;const o=c.create(e.color,e.space);this.delay>0&&this.#g>0?setTimeout((()=>{this.#p.append(o),this.#p,this.play(t)}),this.delay):(this.#p.append(o),this.play(t))}this.#g>=this.#b.length&&(this.#g=0,this.#b=[],this.isRunning=!1,t())}pause(){this.isRunning=!1}reset(){this.isRunning=!1,this.#g=0,this.#b=[]}parseSGF(t){const e=[],o=t.split("\n"),{columnLabels:s,rows:r}=this.#p;for(let t=0;t<o.length;t++){const n=o[t],a=w.exec(n.trim());if(a){const t=a[2].split(""),o=s[m.indexOf(t[0].toUpperCase())],n=r-m.indexOf(t[1].toUpperCase());e.push({color:"B"===a[1]?"black":"white",space:o+n.toString()})}}return e}}customElements.define("sgf-viewer",S),customElements.define("go-board",b),customElements.define("go-stone",c)}();
```
